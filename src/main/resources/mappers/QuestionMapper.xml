<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bleeding.ironbox.dao.QuestionDao">
    <!--  查询问题列表  -->
    <select id="getQuestionList" resultType="java.util.Map" parameterType="java.util.Map">
        select a.*, COUNT(b.replyId) AS replyCount
        from tb_question a
        left join tb_reply b
        on a.questionId = b.questionId
        where 1 = 1
        <if test="keyword neq null and keyword neq ''">
            and concat(a.title, ifnull(a.userId, ''), ifnull(a.contents, ''))
            like concat(concat('%', #{keyword}, '%'))
        </if>
        GROUP BY
        a.questionId
    </select>
    <!--  根据ID查询单个问题详情  -->
    <select id="getQuestionById" resultType="java.util.Map" parameterType="java.lang.String">
    	select a.*, COUNT(b.replyId) AS replyCount
        FROM tb_question a
        LEFT JOIN tb_reply b
        ON a.questionId = b.questionId
        WHERE a.questionId = #{questionId}
        GROUP BY a.questionId
    </select>
    <!--  根据ID查询单个问题的所有回答评论  -->
    <select id="getReplyById" resultType="java.util.Map" parameterType="java.lang.String">
    	select *
    	from tb_reply
    	where questionId = #{questionId}
    </select>
    <!--  删除问题帖子  -->
    <delete id="deleteQuestion" parameterType="java.lang.String">
    	delete from tb_question where questionId in(${ids})
    </delete>
</mapper>